{% extends "base_old.html" %}

{% block title %}Equipment - GearGuard{% endblock %}

{% block content %}
<!-- Top Bar -->
<div class="top-bar">
    <button class="new-btn" onclick="openEquipmentModal()">New</button>
    <div class="search-container">
        <input type="text" class="search-input" id="searchInput" placeholder="a search..." onkeyup="filterEquipment()">
    </div>
</div>

<!-- Equipment Table -->
<div class="table-container" data-animate="fadeInUp" style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-top: 20px;">
    <div class="table-header" style="margin-bottom: 20px;">
        <h2 style="font-size: 1.5rem; font-weight: 700; color: #333; margin: 0;">Equipment</h2>
    </div>
    <table class="data-table" id="equipmentTable" style="width: 100%; border-collapse: collapse; display: table;">
        <thead>
            <tr style="background: #f8f9fa; border-bottom: 2px solid #e0e0e0;">
                <th style="padding: 12px; text-align: left; font-weight: 600; color: #333;">Equipment Name</th>
                <th style="padding: 12px; text-align: left; font-weight: 600; color: #333;">Employee</th>
                <th style="padding: 12px; text-align: left; font-weight: 600; color: #333;">Department</th>
                <th style="padding: 12px; text-align: left; font-weight: 600; color: #333;">Serial Number</th>
                <th style="padding: 12px; text-align: left; font-weight: 600; color: #333;">Technician</th>
                <th style="padding: 12px; text-align: left; font-weight: 600; color: #333;">Equipment Category</th>
                <th style="padding: 12px; text-align: left; font-weight: 600; color: #333;">Company</th>
            </tr>
        </thead>
        <tbody>
            {% if equipment and equipment|length > 0 %}
                {% for eq in equipment %}
                <tr style="border-bottom: 1px solid #e0e0e0; transition: background 0.2s ease; cursor: pointer;" onclick="viewEquipment({{ eq[0] }})">
                    <td style="padding: 12px;"><strong>{{ eq[1] if eq[1] else 'N/A' }}</strong></td>
                    <td style="padding: 12px;">{{ eq[4] if eq[4] else '-' }}</td>
                    <td style="padding: 12px;">{{ eq[5] if eq[5] else '-' }}</td>
                    <td style="padding: 12px;">{{ eq[6] if eq[6] else '-' }}</td>
                    <td style="padding: 12px;">{{ eq[7] if eq[7] else '-' }}</td>
                    <td style="padding: 12px;">{{ eq[18] if eq[18] else '-' }}</td>
                    <td style="padding: 12px;">{{ eq[9] if eq[9] else 'My Company (San Francisco)' }}</td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="7" style="text-align: center; padding: 40px; color: #999;">
                        No equipment found. Click "New" to create one.
                    </td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<!-- Create/Edit Equipment Modal -->
<div id="equipmentModal" class="modal" style="display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); align-items: center; justify-content: center;">
    <div class="modal-content" style="background: white; border-radius: 12px; width: 90%; max-width: 900px; max-height: 90vh; overflow-y: auto; padding: 30px; position: relative;">
        <button class="modal-close" onclick="closeEquipmentModal()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 2rem; color: #999; cursor: pointer; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 8px;">Ã—</button>
        
        <h2 id="modalTitle" style="font-size: 1.8rem; font-weight: 700; color: #333; margin-bottom: 24px;">Create Equipment</h2>
        <form method="POST" action="/create-equipment" id="equipmentForm">
            <input type="hidden" name="equipment_id" id="equipmentId">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <!-- Left Column -->
                <div style="display: grid; gap: 20px;">
                    <div>
                        <label style="display: block; font-size: 0.9rem; font-weight: 600; color: #333; margin-bottom: 8px;">Name *</label>
                        <input type="text" name="name" id="eqName" required style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.9rem; font-weight: 600; color: #333; margin-bottom: 8px;">Equipment Category</label>
                        <select name="equipment_category_id" id="eqCategory" style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem; background: white;">
                            <option value="">Select Category</option>
                            {% for cat in categories %}
                            <option value="{{ cat[0] }}">{{ cat[1] }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.9rem; font-weight: 600; color: #333; margin-bottom: 8px;">Company</label>
                        <input type="text" name="company" id="eqCompany" value="My Company (San Francisco)" style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.9rem; font-weight: 600; color: #333; margin-bottom: 8px;">Used By</label>
                        <select name="used_by" id="eqUsedBy" style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem; background: white;">
                            <option value="">Select</option>
                            <option value="Employee">Employee</option>
                            <option value="Department">Department</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.9rem; font-weight: 600; color: #333; margin-bottom: 8px;">Maintenance Team</label>
                        <input type="text" name="maintenance_team" id="eqMaintenanceTeam" value="Internal Maintenance" style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.9rem; font-weight: 600; color: #333; margin-bottom: 8px;">Assigned Date</label>
                        <input type="date" name="assigned_date" id="eqAssignedDate" style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.9rem; font-weight: 600; color: #333; margin-bottom: 8px;">Description</label>
                        <textarea name="description" id="eqDescription" rows="4" style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem; resize: vertical;"></textarea>
                    </div>
                </div>
                
                <!-- Right Column -->
                <div style="display: grid; gap: 20px;">
                    <div>
                        <label style="display: block; font-size: 0.9rem; font-weight: 600; color: #333; margin-bottom: 8px;">Technician</label>
                        <input type="text" name="technician" id="eqTechnician" style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.9rem; font-weight: 600; color: #333; margin-bottom: 8px;">Employee</label>
                        <input type="text" name="employee" id="eqEmployee" style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.9rem; font-weight: 600; color: #333; margin-bottom: 8px;">Department</label>
                        <input type="text" name="department" id="eqDepartment" style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.9rem; font-weight: 600; color: #333; margin-bottom: 8px;">Serial Number</label>
                        <input type="text" name="serial_number" id="eqSerialNumber" style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.9rem; font-weight: 600; color: #333; margin-bottom: 8px;">Scrap Date</label>
                        <input type="date" name="scrap_date" id="eqScrapDate" style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.9rem; font-weight: 600; color: #333; margin-bottom: 8px;">Used in location</label>
                        <input type="text" name="used_in_location" id="eqUsedInLocation" style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.9rem; font-weight: 600; color: #333; margin-bottom: 8px;">Work Center</label>
                        <select name="work_center_id" id="eqWorkCenter" style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem; background: white;">
                            <option value="">Select Work Center</option>
                            {% for wc in work_centers %}
                            <option value="{{ wc[0] }}">{{ wc[1] }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.9rem; font-weight: 600; color: #333; margin-bottom: 8px;">Health Percentage</label>
                        <input type="number" name="health_percentage" id="eqHealthPercentage" min="0" max="100" value="100" style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem;">
                    </div>
                </div>
            </div>
            <div style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 30px;">
                <button type="button" onclick="closeEquipmentModal()" style="padding: 12px 24px; background: #f5f5f5; color: #333; border: none; border-radius: 8px; font-size: 0.95rem; font-weight: 600; cursor: pointer;">Cancel</button>
                <button type="submit" style="padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 8px; font-size: 0.95rem; font-weight: 600; cursor: pointer;">Save</button>
            </div>
        </form>
    </div>
</div>

<script>
function openEquipmentModal() {
    document.getElementById('equipmentModal').style.display = 'flex';
    document.getElementById('modalTitle').textContent = 'Create Equipment';
    document.getElementById('equipmentForm').action = '/create-equipment';
    document.getElementById('equipmentForm').reset();
    document.getElementById('equipmentId').value = '';
}

function closeEquipmentModal() {
    document.getElementById('equipmentModal').style.display = 'none';
}

function viewEquipment(id) {
    window.location.href = '/equipment/' + id;
}

function filterEquipment() {
    const input = document.getElementById('searchInput');
    const filter = input.value.toLowerCase();
    const table = document.getElementById('equipmentTable');
    const tr = table.getElementsByTagName('tr');
    
    for (let i = 1; i < tr.length; i++) {
        const td = tr[i].getElementsByTagName('td');
        let found = false;
        for (let j = 0; j < td.length; j++) {
            if (td[j]) {
                const txtValue = td[j].textContent || td[j].innerText;
                if (txtValue.toLowerCase().indexOf(filter) > -1) {
                    found = true;
                    break;
                }
            }
        }
        tr[i].style.display = found ? '' : 'none';
    }
}

window.onclick = function(event) {
    const modal = document.getElementById('equipmentModal');
    if (event.target == modal) {
        closeEquipmentModal();
    }
}
</script>

<style>
.data-table {
    display: table !important;
    visibility: visible !important;
    opacity: 1 !important;
}

.table-container {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
}

tbody tr:hover {
    background: #f8f9fa;
}
</style>
{% endblock %}
